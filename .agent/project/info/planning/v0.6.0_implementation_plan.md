# Implementation Plan - v0.6.0: External Data & Analytics

## Goal Description
Enhance Alpha-Sam with real-time market data integration and advanced portfolio analytics. This version moves the application from a manual ledger to a dynamic portfolio tracker by integrating likely `yfinance` for real-time pricing and providing deeper insights into investment performance.

## User Review Required
> [!IMPORTANT]
> **Dependency on External API**: Reliance on `yfinance` (unofficial API) may be unstable. Consider switching to CoinGecko (free tier) or AlphaVantage if stability becomes an issue. For now, `yfinance` is sufficient for MVP.

## Proposed Changes

### Backend

#### [MODIFY] [price_service.py](file:///Users/shin/MyDir/MyGit/Alpha-Sam/backend/app/src/engine/price_service.py)
- **Symbol Validation**: Add `validate_symbol(symbol: str)` method to check if a ticker exists in `yfinance` before creating an Asset.
- **Search**: Add `search_symbol(query: str)` to allow users to find correct tickers (e.g., "Apple" -> "AAPL").
- **Bulk Update**: Optimize `update_all_prices` to use batch fetching if possible, or robust error handling for rate limits.

#### [NEW] [src/routes/market.py](file:///Users/shin/MyDir/MyGit/Alpha-Sam/backend/app/src/routes/market.py)
- `GET /market/search?q=...`: Proxy to `price_service.search_symbol`.
- `GET /market/validate?symbol=...`: Endpoint for frontend validation.

#### [MODIFY] [assets.py](file:///Users/shin/MyDir/MyGit/Alpha-Sam/backend/app/src/routes/assets.py)
- Update `create_asset`: OPTIONAL Step to auto-fill "Name" and "Category" based on Symbol lookup if user provides just the symbol.

### Frontend (FigmaMake)

#### [MODIFY] [Dashboard](file:///Users/shin/MyDir/MyGit/Alpha-Sam/frontend/src/routes/+page.svelte)
- **Refresh Button**: Add a "Refresh Prices" button near the "Last Updated" timestamp.
- **Advanced Chart**: Update Portfolio History chart to show two lines:
    - **Total Value** (Green/Red)
    - **Total Cost** (Grey/dashed)
    - *Visualizes actual profit over time.*

#### [MODIFY] [Asset Creation Modal](file:///Users/shin/MyDir/MyGit/Alpha-Sam/frontend/src/routes/assets/AssetForm.svelte)
- **Symbol Search**: Replace simple text input with a Search+Select component for Ticker Symbol.
    - User types "Bitcoin" -> Dropdown shows "BTC-USD".
    - User selects "BTC-USD" -> "Name" and "Category" auto-filled.

## Verification Plan

### Automated Tests
- **Unit Tests**:
    - `test_price_service.py`: Test `validate_symbol` with valid/invalid tickers.
    - `test_market_routes.py`: Mock `yfinance` and test `/market/search` endpoint.
- **Integration**:
    - Create Asset with valid symbol -> Refresh Prices -> Verify `Price` record created.

### Manual Verification
1.  **Symbol Search**:
    - Go to "Add Asset".
    - Type "Tesla".
    - Verify "TSLA" appears in dropdown.
    - Select it, confirm fields populate.
2.  **Price Updates**:
    - Click "Refresh Prices" on Dashboard.
    - Verify "Current Value" updates.
3.  **Chart**:
    - Ensure Chart shows "Cost Basis" line vs "Market Value" line.
